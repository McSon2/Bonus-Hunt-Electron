<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, shrink-to-fit=no"
    />
    <meta name="description" content="" />
    <meta name="author" content="" />

    <title>Bonus Hunt</title>

    <!-- Custom fonts for this template-->
    <link
      href="vendor/fontawesome-free/css/all.min.css"
      rel="stylesheet"
      type="text/css"
    />
    <link
      href="https://fonts.googleapis.com/css?family=Nunito:200,200i,300,300i,400,400i,600,600i,700,700i,800,800i,900,900i"
      rel="stylesheet"
    />
    <link href="vendor/datatables/dataTables.bootstrap4.min.css" rel="stylesheet"/>

    <!-- Custom styles for this template-->
    <link href="css/sb-admin-2.min.css" rel="stylesheet" />
    <link href="css/custom.css" rel="stylesheet" />
  </head>

  <body id="page-top">
    <!-- Page Wrapper -->
    <div id="wrapper">
      <!-- Sidebar -->
      <ul
        class="navbar-nav bg-gradient-primary sidebar sidebar-dark accordion fixed-top"
        id="accordionSidebar"
      >
        <!-- Sidebar - Brand -->
        <a
          class="sidebar-brand d-flex align-items-center justify-content-center"
          href="index.html"
        >
          <div class="logo">
            <img src="./images/bonus.png" height="40px" />
          </div>
          <div class="sidebar-brand-text mx-3">Bonus Hunt</div>
        </a>

        <!-- Divider -->
        <hr class="sidebar-divider my-0" />

        <!-- Nav Item - Dashboard -->
        <li class="nav-item active">
          <a class="nav-link" href="index.html">
            <i class="nav-icon fas fa-home"></i>
            <span>Dashboard</span></a
          >
        </li>

        <!-- Divider 
            <hr class="sidebar-divider">
            -->

        <!-- Heading 
            <div class="sidebar-heading">
                Interface
            </div>
            -->

            
        <!--      
          <li class="nav-item">
            <a class="nav-link" href="HTML/bonushunt.html">
              <i class="nav-icon fas fa-bullseye"></i>
              <span>Bonus Hunts</span></a
            >
          </li>

          <li class="nav-item">
            <a class="nav-link" href="HTML/tournaments.html">
              <i class="nav-icon fas fa-chess"></i>
              <span>Tournaments</span></a
            >
          </li>

          <li class="nav-item">
            <a class="nav-link" href="HTML/widgets.html">
              <i class="nav-icon fas fa-th"></i>
              <span> Streaming Widgets </span>
            </a>
          </li>

          <li class="nav-item">
            <a class="nav-link" href="HTML/setwidgets.html">
              <i class="nav-icon fas fa-cog"></i>
              <span> Widgets Settings </span>
            </a>
          </li>

          <li class="nav-item">
            <a class="nav-link" href="HTML/stats.html">
              <i class="nav-icon fas fa-chart-line"></i>
              <span> Statistics </span>
            </a>
          </li>

          Nav Item - Pages Collapse Menu 
              <li class="nav-item">
                  <a class="nav-link collapsed" href="#" data-toggle="collapse" data-target="#collapseTwo"
                      aria-expanded="true" aria-controls="collapseTwo">
                      <i class="fas fa-fw fa-cog"></i>
                      <span>Components</span>
                  </a>
                  <div id="collapseTwo" class="collapse" aria-labelledby="headingTwo" data-parent="#accordionSidebar">
                      <div class="bg-white py-2 collapse-inner rounded">
                          <h6 class="collapse-header">Custom Components:</h6>
                          <a class="collapse-item" href="buttons.html">Buttons</a>
                          <a class="collapse-item" href="cards.html">Cards</a>
                      </div>
                  </div>
              </li>

        -->

        <!-- Divider -->
        <hr class="sidebar-divider" />

        <!-- Sidebar Toggler (Sidebar) -->
        
      </ul>
      <!-- End of Sidebar -->

      <!-- Content Wrapper -->
      <div id="content-wrapper" class="d-flex flex-column">
        <!-- Main Content -->
        <div id="content">
          <!-- Topbar -->
          <nav id="topMenu" class="navbar navbar-expand navbar-dark bg-light topbar static-top shadow-5-strong fixed-top">
            <!-- Sidebar Toggle (Topbar) -->
            <button
              id="sidebarToggleTop"
              class="btn btn-link d-md-none rounded-circle mr-3"
            >
              <i class="fa fa-bars"></i>
            </button>
            <!-- Title Bar -->
            <u class="nav" id="topMenuBtns">
              <li>
                <button id="reduceBtn" class="topMenuBtn">&minus;</button>
              </li>
              <li>
                <button id="sizeBtn" class="topMenuBtn">
                  &#128470;&#xFE0E;
                </button>
              </li>
              <li>
                <button id="closeBtn" class="topMenuBtn">
                  &#128473;&#xFE0E;
                </button>
              </li>
            </u>
          </nav>
          <!-- End of Topbar -->

          <!-- Begin Page Content -->
          <div class="container-fluid justify-content-center col-sm-12" id="BOD">
            <!-- Page Heading -->

            <div
              class="d-sm-flex align-items-center justify-content-between mb-4"
            >
              <h1 class="h3 mb-0 text-gray-800">Dashboard</h1>
            </div>

            <!-- End Page Heading -->

            <!-- WIDGET -->

            <div class="row">
              <!-- Earnings (Monthly) Card Example -->
              <div class="col-xl-3 col-md-6 mb-4">
                <div class="card border-left-primary shadow h-100 py-2">
                  <div class="card-body">
                    <div class="row no-gutters align-items-center">
                      <div class="col mr-2">
                        <div
                          class="text-xs font-weight-bold text-primary text-uppercase mb-1"
                        >
                          Bonus Hunts
                        </div>
                        <div
                          class="h5 mb-0 font-weight-bold text-gray-800"
                          id="nbonus"
                        >
                          3
                        </div>
                      </div>
                      <div class="col-auto">
                        <i class="far fa-bookmark fa-2x text-gray-300"></i>
                      </div>
                    </div>
                  </div>
                </div>
              </div>

              <script></script>

              <!-- Earnings (Monthly) Card Example -->
              <div class="col-xl-3 col-md-6 mb-4">
                <div class="card border-left-danger shadow h-100 py-2">
                  <div class="card-body">
                    <div class="row no-gutters align-items-center">
                      <div class="col mr-2">
                        <div
                          class="text-xs font-weight-bold text-danger text-uppercase mb-1"
                        >
                          Total Cost
                        </div>
                        <div
                          class="h5 mb-0 font-weight-bold text-gray-800"
                          id="TotalCost"
                        >
                          $1,000.00
                        </div>
                      </div>
                      <div class="col-auto">
                        <i class="fas fa-dollar-sign fa-2x text-gray-300"></i>
                      </div>
                    </div>
                  </div>
                </div>
              </div>

              <!-- Earnings (Monthly) Card Example -->
              <div class="col-xl-3 col-md-6 mb-4">
                <div class="card border-left-success shadow h-100 py-2">
                  <div class="card-body">
                    <div class="row no-gutters align-items-center">
                      <div class="col mr-2">
                        <div
                          class="text-xs font-weight-bold text-success text-uppercase mb-1"
                        >
                          Total Winnings
                        </div>
                        <div
                          class="h5 mb-0 font-weight-bold text-gray-800"
                          id="TotalWin"
                        >
                          $500.00
                        </div>
                      </div>
                      <div class="col-auto">
                        <i class="fas fa-dollar-sign fa-2x text-gray-300"></i>
                      </div>
                    </div>
                  </div>
                </div>
              </div>

              <!-- Pending Requests Card Example -->
              <div class="col-xl-3 col-md-6 mb-4">
                <div class="card border-left-warning shadow h-100 py-2">
                  <div class="card-body">
                    <div class="row no-gutters align-items-center">
                      <div class="col mr-2">
                        <div
                          class="text-xs font-weight-bold text-warning text-uppercase mb-1"
                        >
                          Profit/Loss +/-
                        </div>
                        <div
                          class="h5 mb-0 font-weight-bold text-gray-800"
                          id="ProfitLoss"
                        >
                          $-500.00
                        </div>
                      </div>
                      <div class="col-auto">
                        <i class="fas fa-dollar-sign fa-2x text-gray-300"></i>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <!-- End WIDGET -->

            <!-- Winnings vs. Costs -->

            <div class="row">
              <!-- Area Chart -->
              <div class="col-xl-12 col-lg-20">
                <div class="card shadow mb-4">
                  <!-- Card Header - Dropdown -->
                  <div
                    class="card-header py-3 d-flex flex-row align-items-center justify-content-between"
                  >
                    <h6 class="m-0 font-weight-bold text-primary">
                      Profit / Loss
                    </h6>
                  </div>
                  <!-- Card Body -->
                  <div class="card-body">
                    <div class="chart-area">
                      <canvas id="myAreaChart"></canvas>
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <!-- End Winnings vs. Costs -->
            
            <!-- Modal Ajout hunt -->

            <div class="modal fade show" id="PlusHunt" aria-labelledby="titlemodaladdhunt" aria-modal="true">
              <div class="modal-dialog modal-dialog-centered">
                <div class="modal-content">
                  <div class="modal-header">
                    <h5 class="modal-title" id="titlemodaladdhunt">Create Bonus Hunt</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                      <span aria-hidden="true">&times;</span>
                    </button>
                  </div>
                  <div class="modal-body">
                    <div class="form-group">
                      <label for="NameHunt">Name</label>
                      <input class="form-control" type="text" id="NameHunt" placeholder="Bonus Hunt 500$" name="HuntName">
                    </div>
                    <div class="form-group">
                      <label for="StartHunt">Start</label>
                      <input class="form-control" type="number" min="0" max="10000000" step="1" id="StartHunt" placeholder="500" name="StartHunt">
                    </div>
                    <div class="form-group">
                      <label for="DateHunt">Date</label>
                      <input class="form-control" type="date" id="DateHunt" name="DateHunt">
                    </div>
                  </div>
                  <div class="modal-footer justify-content-between">
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                    <button type="submit" class="btn btn-primary" data-dismiss="modal" id="SaveHunt">Save</button>
                  </div>
                </div>
              </div>
            </div>
            
            <!-- Modal Modif hunt -->

            <div class="modal fade show" id="UpdateHunt" aria-labelledby="titlemodaladdhunt" aria-modal="true">
              <div class="modal-dialog modal-dialog-centered">
                <div class="modal-content">
                  <div class="modal-header">
                    <h5 class="modal-title" id="titlemodaladdhunt">Update Bonus Hunt</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                      <span aria-hidden="true">&times;</span>
                    </button>
                  </div>
                  <div class="modal-body">
                    <div class="form-group">
                      <label for="updatenamehunt">Name</label>
                      <input class="form-control" type="text" id="updatenamehunt" placeholder="Bonus Hunt 500$" name="HuntName">
                    </div>
                    <div class="form-group">
                      <label for="updatestarthunt">Start</label>
                      <input class="form-control" type="number" min="0" max="10000000" step="1" id="updatestarthunt" placeholder="500" name="updatestarthunt">
                    </div>
                    <div class="form-group">
                      <label for="updatedatehunt">Date</label>
                      <input class="form-control" type="date" id="updatedatehunt" name="updatedatehunt">
                    </div>
                  </div>
                  <div class="modal-footer justify-content-between">
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                    <button type="submit" class="btn btn-primary" data-dismiss="modal" id="updatehunt">Save</button>
                  </div>
                </div>
              </div>
            </div>

            <!-- Modal delete hunt -->

            <div class="modal fade show" id="deleteHunt" aria-labelledby="titlemodaladdhunt" aria-modal="true">
              <div class="modal-dialog modal-dialog-centered">
                <div class="modal-content">
                  <div class="modal-header">
                    <h5 class="modal-title" id="titlemoddalsupphunt">Remove this Hunt ?</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                      <span aria-hidden="true">&times;</span>
                    </button>
                  </div>
                  <div class="modal-footer justify-content-between">
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">No</button>
                    <button type="submit" class="btn btn-primary deletethishunt" data-dismiss="modal" id="deletethishunt">Yes</button>
                  </div>
                </div>
              </div>
            </div>

            <!-- Table -->

            <div class="row">
              <div class="col-md-12">
                <div class="card">
                  <div class="card-header ">
                    <h3 class="card-title float-left">Bonus Hunts</h3>
                    <button type="button" class="btn btn-success float-right" data-toggle="modal" data-target="#PlusHunt" id="plushunt">
                      <i class="fas fa-plus-circle"></i>
                    </button>
                  </div>
                  <div class="card-body p-0">
                    <table class="table table-striped table-hover" id="tableBonushunt">
                      <thead class="thead-light">
                        <tr>
                          <th scope="col">Bonus Hunt Title</th>
                          <th scope="col">Start-cost</th>
                          <th scope="col">Date</th>
                          <th scope="col">Bonus</th>
                          <th scope="col">Profit/Loss</th>
                          <th scope="col" style="width:180px" class="text-center">Actions</th>
                        </tr>
                      </thead>
                      <tbody>
                      </tbody>
                    </table>
                  </div>
                </div>
              </div>
            </div>
            <!-- End Table -->
          </div>
          <!-- End Page Content -->
        </div>

        <!-- End Main Content -->

        <!-- Footer -->
        <footer class="sticky-footer bg-white">
          <div class="container my-auto">
            <div class="copyright text-center my-auto">
              <span></span>
            </div>
          </div>
        </footer>
        <!-- End of Footer -->
      </div>
      <!-- End of Content Wrapper -->
    </div>
    <!-- End of Page Wrapper -->



    <!-- Scroll to Top Button-->
    <a class="scroll-to-top rounded" href="#page-top">
      <i class="fas fa-angle-up"></i>
    </a>

    <!-- Bootstrap core JavaScript-->
    <script src="vendor/jquery/jquery.min.js"></script>
    <script src="vendor/bootstrap/js/bootstrap.bundle.min.js"></script>
    <script src="vendor/bootstrap/js/bootstrap.min.js"></script>

    <!-- Core plugin JavaScript-->
    <script src="vendor/jquery-easing/jquery.easing.min.js"></script>
    <script src="vendor/datatables/jquery.dataTables.min.js"></script>
    <script src="vendor/datatables/dataTables.bootstrap4.min.js"></script>

    <!-- Custom scripts for all pages-->
    <script src="js/sb-admin-2.min.js"></script>
    <script src="./js/titlebar.js"></script>
    <script src="./js/renderer.js"></script>

    <!-- Page level plugins -->
    <script src="vendor/chart.js/Chart.min.js"></script>

    <!-- Page level custom scripts -->
    <script src="js/chart-area.js"></script>

    <!--SCRIPT SQL-->

    <script>

      //widget

      //nombre de bonus
      document.addEventListener("DOMContentLoaded", async () => {
        let nbonus = window.api.getNbonus();
        let divNames = document.getElementById("nbonus");
        let nameString = nbonus.map((elem) => {
          return elem.nbonus;
        });

        divNames.innerHTML = nameString;
      });

      //cout total
      document.addEventListener("DOMContentLoaded", async () => {
        let TotalCost = window.api.getTotalCost();
        let divNames = document.getElementById("TotalCost");
        let nameString = TotalCost.map((elem) => {
          return elem.totalcost;
        });

        divNames.innerHTML = "$" + nameString;
      });

      //total win
      document.addEventListener("DOMContentLoaded", async () => {
        let TotalWin = window.api.getTotalWin();
        let divNames = document.getElementById("TotalWin");
        let nameString = TotalWin.map((elem) => {
          var num = elem.totalwin
          num = num.toFixed(2)
          return num;
        });
 
        divNames.innerHTML = "$ " + nameString;
      });

      //profit loss
      document.addEventListener("DOMContentLoaded", async () => {
        let ProfitLoss = window.api.getProfitLoss();
        let divNames = document.getElementById("ProfitLoss");
        let nameString = ProfitLoss.map((elem) => {
          var num = elem.ProfitLoss
          num = num.toFixed(2)
          return num;
        });

        divNames.innerHTML = "$ " + nameString;
      });

      //ajout d'un hunt
      const SaveHunt = document.getElementById("SaveHunt");
      SaveHunt.addEventListener('click', () => {
        const NameHunt = document.getElementById("NameHunt");
        const StartHunt = document.getElementById("StartHunt");
        const DateHunt = document.getElementById("DateHunt");
        const title = NameHunt.value;
        const start = StartHunt.value;
        const date = DateHunt.value;
        window.api.newHunt(title,start,date);

        var id = window.api.getidhunt(title)
        var nameString = id.map((elem) => {
          var num = elem.id
          return num
        })
        
        var string = title
        var string2 = string.replace("#", "")
        var title2 = string2.split(" ").join("_")
        location.href = "./bonus.html" + "?id=" + nameString + "&title=" + title2
        
      })

      

      //bonus hunt table
      document.addEventListener("DOMContentLoaded", async () => {

        let bonushunt = window.api.bonushunt();
        
        var tableBonushuntbody = document.getElementById("tableBonushunt").getElementsByTagName("tbody")[0]
        var tableBonushunt = document.getElementById("tableBonushunt")
        var tableRows = tableBonushunt.querySelectorAll("thead > tr")
        
        tableRows.forEach((el, i) => {
          if(i > 0)
            el.parentNode.removeChild(el);
        });


        bonushunt.forEach((el) => {
          var row = tableBonushuntbody.insertRow(0);
          var profitloss = el.profitloss
          if (profitloss !== null) {
            profitloss = profitloss.toFixed(2);}
          

          var cell1 = row.insertCell(0);
          var cell2 = row.insertCell(1);
          var cell3 = row.insertCell(2);
          var cell4 = row.insertCell(3);
          var cell5 = row.insertCell(4);
          var cell6 = row.insertCell(5);

          row.setAttribute('scope', "row")
          cell6.setAttribute('class', "text-center")

          cell1.innerHTML = el.title;
          cell2.innerHTML = el.start;
          cell3.innerHTML = el.date;
          cell4.innerHTML = el.nbbonus;
          cell5.innerHTML = profitloss;
          cell6.innerHTML = 
          '<div class="btn-group">\
            <button type="button"\
              class="btn btn-warning"\
              id="htmlhunt"\
              >\
              <i class="fas fa-search"></i>\
            </button>\
            <button type="button"\
              class="btn btn-info toggleEditModal"\
              data-toggle="modal"\
              data-target="#UpdateHunt"\
              data-title="' + el.title +'"\
              data-start="' + el.start +'"\
              data-date="' + el.date +'"\
              data-id="' + el.id +'"\
              id="id:'+ el.id +'"\
              >\
              <i class="fas fa-pen"></i>\
            </button>\
            <button type="button"\
              class="btn btn-danger toggleTrashModal"\
              data-toggle="modal"\
              data-target="#deleteHunt"\
              data-whatever="'+ el.title +'"\
              data-id="'+ el.id +'"\
              id="'+ el.id +'"\
              >\
              <i class="fas fa-trash"></i>\
            </button>\
          </div>'
          
          //$('#deleteHunt').on('show.bs.modal', function (event) {
            //var button = $(event.relatedTarget) 
            //var title = button.data('whatever')
            //var id = button.data('id') 
            //var modal = $(this)
            //modal.find('.modal-title').text('Remove this hunt : ' + title + '?')
            //modal.find('.deletethishunt').attr('id',+ id)
            //$("#"+id).click(function() {
              //console.log("*** remove hunt :", id);
              //window.api.deletehunt(id)
              //app.window.reload();
            //})
         // })

         var test = "id:"+el.id
         var updateyes = document.getElementById("updatehunt");
          var btnupdate = document.getElementById(test)
          var updatenamehunt = document.getElementById("updatenamehunt");
          var updatestarthunt = document.getElementById("updatestarthunt");
          var updatedatehunt = document.getElementById("updatedatehunt");
          btnupdate.addEventListener('click', () => {
            var dates = el.date
            var formatdate = dates.split("/").reverse().join("-")
            updatenamehunt.setAttribute('value',el.title);
            updatestarthunt.setAttribute('value',el.start);
            updatedatehunt.setAttribute('value',formatdate);
            updateyes.id = el.id;
            updateyes.addEventListener('click', () => {
              const title = updatenamehunt.value;
              const start = updatestarthunt.value;
              const date = updatedatehunt.value;
              window.api.updatehunt(title,start,date,updateyes.id);
              app.window.reload();
            })
          })

          var deleteyes = document.getElementById("deletethishunt");
          var btndelete = document.getElementById(el.id);
          var titlemoddal = document.getElementById("titlemoddalsupphunt");
          btndelete.addEventListener('click', () => {
            titlemoddal.innerHTML = "Remove this hunt ?" + "<br>" + el.title;
            deleteyes.id = el.id;
            deleteyes.addEventListener('click', () => {
              window.api.deletehunt(deleteyes.id);
              app.window.reload();
            })
          })

          

          var redirect = document.getElementById("htmlhunt");
          var string = el.title
          var string2 = string.replace("#", "")
          var title = string2.split(" ").join("_")
          redirect.addEventListener('click', () => {
            location.href = "./bonus.html" + "?id=" + el.id + "&title=" + title
          })

          

        })
        
        $('#tableBonushunt').DataTable();
      });

      
      
    </script>


  </body>
</html>
